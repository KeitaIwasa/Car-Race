# Street Sprint 3D

「Street Sprint 3D」は、Three.js で構築された 3 レーン形式のハイスピード・エンドレスラン型カーレースです。車線変更とジャンプを組み合わせ、迫りくる車両や逆走車をかわしつつ、街路樹と摩天楼が連なる夜明け前のストリートを駆け抜けます。スコアは速度とテクニックに応じて加算され、ハイスコアはブラウザのローカルストレージに保存されます。

- ブラウザのみで動作（ビルド工程なし）
- Three.js (r158) によるフル 3D 描画
- PC キーボード／スマートフォンのタッチ操作両対応
- 逆走車・熊のマスコットなどのイベントでスコアボーナス

## 目次
1. [開発環境](#開発環境)
2. [クイックスタート](#クイックスタート)
3. [ゲームの遊び方](#ゲームの遊び方)
4. [スコアリングとギミック](#スコアリングとギミック)
5. [主要技術](#主要技術)
6. [ファイル構成](#ファイル構成)
7. [開発メモ](#開発メモ)
8. [ライセンス](#ライセンス)

## 開発環境
- 必要要件: WebGL 対応ブラウザ（Chrome / Edge / Firefox / Safari など）
- 推奨 OS: Windows / macOS / Linux（スマートフォンはプレイのみ対応）
- 追加ソフト: ローカル HTTP サーバー（ES Modules を安全に読み込むため）

## クイックスタート
1. リポジトリを任意のディレクトリへクローンまたはダウンロードします。
2. プロジェクト直下で簡易サーバーを起動します。例:
   - `npx serve .`
   - もしくは `python -m http.server 5173`
3. ブラウザで `http://localhost:3000`（上記コマンドのポートに応じて読み替え）を開き、`index.html` を表示します。
4. 「スタート」ボタンを押すか Enter キーで走行を開始します。

> メモ: ファイルを直接ダブルクリックで開くと、モジュール読み込みが遮断されるブラウザがあります。必ずローカルサーバー経由でアクセスしてください。

## ゲームの遊び方
- **車線変更**: `← / →` または `A / D`
- **ジャンプ**: スペースキー（走行中のみ／着地後にクールダウンあり）
- **開始 / リトライ**: Enter キー または 画面内「スタート / リトライ」ボタン
- **タッチ操作**: 画面下部の `◁` `▷` ボタンで車線変更、中央のジャンプボタンで跳躍

走行中はスピードが徐々に上がり、スコアの上昇率も加速します。ジャンプ中は車両との衝突判定が緩くなるため、飛び越えてボーナスを狙いましょう。

## スコアリングとギミック
- **連続追い越しボーナス**: 同一レーンで敵車を連続で飛び越えると追加スコア。
- **逆走車イベント**: スコアが一定値を超えると逆走車が出現。ヘッドライト付きで接近するため視認性はありますが衝突リスク大。
- **熊のマスコット**: ランダムに出現。触れると `+260` のボーナスと破片エフェクト。
- **スピード計**: 現在速度を `km/h` 表記で HUD に表示。
- **ハイスコア保存**: `localStorage` のキー `street-sprint-best` に自動保存。

ゲームオーバー後は結果とハイスコア更新状況がオーバーレイに表示され、すぐに再挑戦できます。

## 主要技術
- **Three.js r158**: モデル生成、フォグ、ライト、パーティクルなどすべてを CDN から読み込み。
- **モジュラー構成の ES Modules**: `main.js` をエントリーポイントとして、シーン、プレイヤー、敵生成、UI などをファイル単位で分割。
- **カスタムジオメトリ生成**: `entities.js` 内で自動車や建築物、街路樹、マスコットをプロシージャルに生成。
- **レスポンシブ UI**: `style.css` にて画面サイズに応じてキャンバスとサイドバーのレイアウトを調整。
- **アクセシビリティ配慮**: キーボード操作、`aria-label` 付きキャンバス、HUD のライブリージョン（オーバーレイ）を実装。

## ファイル構成
```
.
├─ index.html        # ゲームコンテナと UI 要素の定義、Three.js モジュール読み込み
├─ style.css         # レイアウト・HUD・ボタンのスタイリング
├─ main.js           # ゲームループ、状態管理、初期化処理
├─ constants.js      # 物理定数・レーン位置・スコア関連定義
├─ scene.js          # レンダラー / カメラ / ライト / ラインマーカーの制御
├─ environment.js    # 背景都市・樹木の生成とスクロール処理
├─ entities.js       # 車両、乗客、熊など 3D エンティティの構築
├─ player.js         # 車線移動・ジャンプ・速度制御・カメラ追従
├─ spawners.js       # 敵車・熊の生成、衝突判定、スコア算出
├─ effects.js        # スコアポップアップと破片エフェクト
├─ controls.js       # キーボード／タッチ入力のバインディング
├─ ui.js             # HUD 更新、オーバーレイ表示、DOM 参照
└─ strings.js        # ゲーム内テキスト（日本語）定義
```

## 開発メモ
- Three.js のバージョンを更新する場合は `scene.js` および `environment.js` での API 互換性に注意してください。
- モバイルブラウザ向けにパフォーマンス調整を行う場合は、`constants.js` の `MARKER_ROWS` や `SCENERY_SEGMENT_COUNT` を削減すると描画負荷を抑えられます。
- 追加言語をサポートしたい場合は `strings.js` を多言語化し、`initializeUiText` で選択できるよう拡張してください。

